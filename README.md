
# Heart Rate Variability (HRV) Prediction using Rolling Window

This project implements a machine learning model to predict Heart Rate Variability (HRV) using a rolling 30-day window approach. It explores two different feature selection methods: Forward Feature Selection (FFS) and Backward Feature Selection (BFS).

## Project Structure

- `ffs_rolling_hrv_prediction_30day_window.py`: Python script implementing the HRV prediction with Forward Feature Selection.
- `bfs_rolling_hrv_prediction_30day_window.py`: Python script implementing the HRV prediction with Backward Feature Selection.
- `data/processed/combined_data_1min.csv`: Input data file containing minute-by-minute HRV and related measurements.
- `plots/ffs-30day-plots/`: Directory where plots generated by the FFS script are saved.
- `plots/bfs-30day-plots/`: Directory where plots generated by the BFS script are saved.

## Requirements

- Python 3.x
- pandas
- numpy
- scikit-learn
- matplotlib
- seaborn

Install the required packages using pip:

```bash
pip install pandas numpy scikit-learn matplotlib seaborn
```

## Data

The script expects a CSV file named `combined_data_1min.csv` in the `data/processed/` directory. This file should contain time-series data with a timestamp column (`minutes__minute`) and a target HRV column (`night_hrv` or `minutes__value__rmssd`). Other numerical columns will be considered as potential features.

## How to Run

Navigate to the project root directory in your terminal.

To run the script with Forward Feature Selection:

```bash
python ffs_rolling_hrv_prediction_30day_window.py
```

To run the script with Backward Feature Selection:

```bash
python bfs_rolling_hrv_prediction_30day_window.py
```

The scripts will process the data, perform feature selection, train a Random Forest Regressor model on a rolling 30-day window, make predictions for the next day, calculate performance metrics, and generate various plots.

## Model Details

- **Rolling Window:** Uses a 30-day training window sliding forward one day at a time to predict the next day's HRV.
- **Target Variable:** Primarily focuses on nighttime HRV (`night_hrv`), falling back to `minutes__value__rmssd` if `night_hrv` is not available.
- **Data Filtering:** Filters data to include only nighttime measurements (22:00 to 06:00).
- **Feature Engineering:** Includes features like 1-minute differences and rolling statistics (mean and standard deviation over 5 minutes) for HRV and potentially Heart Rate.
- **Feature Selection:**
  - FFS: Iteratively adds features that improve R² on a validation set.
  - BFS: Iteratively removes features that least degrade R² on a validation set.
- **Model:** Random Forest Regressor with configurable parameters (n_estimators=50, max_depth=10, etc.).
- **Scaling:** Uses RobustScaler for both features and the target variable to handle potential outliers.
- **Data Requirements:** Requires minimum data points per day and within the training window for valid predictions.
- **Outlier Handling:** Excludes R² scores below -10 from overall performance metrics calculation.

## Output

The scripts print progress and performance metrics to the console for each window. They also generate several plots saved in their respective `plots/` subdirectories:

- Daily predictions vs actual values and residuals for selected days.
- All predictions vs actual values and residuals over time.
- Model performance metrics (R², RMSE, MAE, MAPE) over time.
- Prediction error analysis plots.
- Time series analysis of predictions and rolling means.
- Feature importance plot (for the first window with sufficient data).

## Key Concepts

- **Rolling Window:** Training a new model for each prediction day using recent historical data.
- **Feature Selection (FFS/BFS):** Automatically identifying the most relevant features for prediction.
- **Robust Scaling:** Preprocessing data to be less sensitive to outliers.
- **R² Score & RMSE:** Metrics for evaluating regression model performance.
